<?xml version="1.0"?>
<sdf version="1.7">
  <model name="interceptor">

    <pose>0 0 0 0 0 0</pose>

    <!-- ================================================= -->
    <!-- ================= HULL BASE ====================== -->
    <!-- ================================================= -->
    <link name="base_link">
      <inertial>
        <mass>35</mass>
        <pose>0 -0.16221 0 0 0 0</pose>
        <inertia>
          <ixx>14.85825</ixx>
          <iyy>2.31825</iyy>
          <izz>16.17825</izz>
        </inertia>
      </inertial>

      <collision name="collision">
        <geometry>
          <mesh>
            <uri>models://monodrone_1800/meshes/collider.dae</uri>
          </mesh>
        </geometry>
      </collision>

      <visual name="visual">
        <geometry>
          <mesh>
            <uri>models://monodrone_1800/meshes/visual.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <plugin filename="gz-sim-pose-publisher-system"
        name="gz::sim::systems::PosePublisher">
        <publish_collision_pose>false</publish_collision_pose>
        <publish_visual_pose>false</publish_visual_pose>
        <publish_sensor_pose>false</publish_sensor_pose>
        <publish_link_pose>false</publish_link_pose>
        <publish_model_pose>true</publish_model_pose>
        <publish_nested_model_pose>false</publish_nested_model_pose>
        <use_pose_vector_msg>false</use_pose_vector_msg>
        <static_publisher>false</static_publisher>
      </plugin>
    </link>

    <!-- ================================================= -->
    <!-- ================= SENSORS FRAME ================== -->
    <!-- ================================================= -->
    <link name="sensors_frame_link">
      <pose>0 0 0 0 0 0</pose>
      <inertial>
        <mass>0.5</mass>
      </inertial>
      <visual name="visual">
        <geometry>
          <mesh>
            <uri>models://sensors_frame/meshes/visual.dae</uri>
          </mesh>
        </geometry>
      </visual>
    </link>

    <joint name="fix_sensors_frame" type="fixed">
      <parent>base_link</parent>
      <child>sensors_frame_link</child>
    </joint>

    <!-- ================= CAM MONOCHROME ================= -->
    <link name="cam_monochrome_link">
      <pose>0.027124 -0.25532 0.44105 0 0 0</pose>

      <inertial>
        <mass>0.1</mass>
      </inertial>

      <visual name="cam_monochrome_visual">
        <geometry>
          <mesh>
            <uri>models://cam_monochrome/meshes/visual.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <sensor name="cam_monochrome" type="camera">
        <!-- Pose du capteur dans le link -->
        <pose>0 0.1 0 0 0 1.5708</pose>
        <topic>interceptor/cam_mono</topic>
        <gz_frame_id>cam_mono_interceptor</gz_frame_id>

        <always_on>true</always_on>
        <update_rate>25</update_rate>

        <camera>
          <!-- Pose de la caméra dans le capteur -->
          <pose>0 0.1 0 0 0 1.5708</pose>

          <horizontal_fov>1.2</horizontal_fov>

          <image>
            <width>960</width>
            <height>600</height>
            <format>L8</format>
          </image>

          <clip>
            <near>0.02</near>
            <far>300</far>
          </clip>

          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>0.007</stddev>
          </noise>
        </camera>
      </sensor>
    </link>

    <joint name="fix_cam_monochrome" type="fixed">
      <parent>base_link</parent>
      <child>cam_monochrome_link</child>
    </joint>


    <!-- ================= CAM RGB ================= -->
    <link name="cam_rgb_link">
      <pose>-0.029617 -0.24911 0.44233 0 0 0</pose> <!-- ajuste si besoin -->

      <inertial>
        <mass>0.1</mass>
      </inertial>

      <visual name="cam_rgb_visual">
        <geometry>
          <mesh>
            <uri>models://cam_rgb/meshes/visual.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <sensor name="cam_rgb" type="camera">
        <pose>0 0.1 0 0 0 1.5708</pose>
        <always_on>true</always_on>
        <update_rate>25</update_rate>
        <topic>interceptor/cam_rgb</topic>
        <gz_frame_id>cam_rgb_interceptor</gz_frame_id>

        <camera>
          <horizontal_fov>0.8</horizontal_fov>
          <image>
            <width>960</width>
            <height>600</height>
            <format>R8G8B8</format>
          </image>
          <clip>
            <near>0.02</near>
            <far>300</far>
          </clip>

          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>0.007</stddev>
          </noise>
        </camera>
      </sensor>
    </link>

    <joint name="fix_cam_rgb" type="fixed">
      <parent>base_link</parent>
      <child>cam_rgb_link</child>
    </joint>

    <!-- ================= CAM THERMAL ================= -->
    <link name="cam_thermal_link">
      <pose>0 -0.18504 0.490955 0 0 0</pose>

      <inertial>
        <mass>0.1</mass>
      </inertial>

      <visual name="cam_thermal_visual">
        <geometry>
          <mesh>
            <uri>models://cam_thermal/meshes/visual.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <!-- Désactivée pour éviter crash avec les vagues -->
      <!--
  <sensor name="cam_thermal" type="thermal_camera">
    <always_on>true</always_on>
    <update_rate>50</update_rate>
    <camera>
      <pose>0 0.1 0 0 0 1.5708</pose>
      <horizontal_fov>1.309</horizontal_fov>
      <image>
        <width>640</width>
        <height>512</height>
        <format>L8</format>
      </image>
      <clip>
        <near>0.02</near>
        <far>300</far>
      </clip>
      <noise type="gaussian">
        <mean>0.0</mean>
        <stddev>0.007</stddev>
      </noise>
    </camera>
  </sensor>
  -->
    </link>

    <joint name="fix_cam_thermal" type="fixed">
      <parent>base_link</parent>
      <child>cam_thermal_link</child>
    </joint>


    <!-- ================= LIDAR ================= -->
    <link name="lidar_link">
      <pose>0 -0.21116 0.55302 0 0 0</pose>
      <visual name="visual">
        <geometry>
          <mesh>
            <uri>models://lidar_os1-64/meshes/visual.dae</uri>
          </mesh>
        </geometry>
      </visual>
      <inertial>
        <mass>0.1</mass>
      </inertial>
      <sensor name="lidar" type="gpu_ray">
        <topic>interceptor/lidar</topic>
        <gz_frame_id>lidar_interceptor</gz_frame_id>
        <update_rate>10</update_rate>
        <lidar>
          <scan>
            <horizontal>
              <samples>1024</samples>
              <min_angle>-3.14159</min_angle>
              <max_angle>3.14159</max_angle>
            </horizontal>
            <vertical>
              <samples>64</samples>
              <min_angle>-0.4</min_angle>
              <max_angle>0.4</max_angle>
            </vertical>
          </scan>
          <range>
            <min>0.05</min>
            <max>120</max>
          </range>
        </lidar>
      </sensor>
    </link>
    <joint name="fix_lidar" type="fixed">
      <parent>sensors_frame_link</parent>
      <child>lidar_link</child>
    </joint>

    <!-- ================= GPS ================= -->
    <link name="gps_link">
      <spherical_coordinates>
        <surface_model>EARTH_WGS84</surface_model>
        <world_frame_orientation>ENU</world_frame_orientation>
        <latitude_deg>48.199227</latitude_deg>
        <longitude_deg>-3.014601</longitude_deg>
        <elevation>0</elevation>
        <heading_deg>0</heading_deg>
      </spherical_coordinates>


      <pose>0 -0.89 0.51 0 0 0</pose>

      <sensor name="gps" type="navsat">
        <always_on>1</always_on>
        <update_rate>5</update_rate>
        <topic>interceptor/gps</topic>
        <gz_frame_id>gps_interceptor</gz_frame_id>
        <horizontal_position_noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.05</stddev>
        </horizontal_position_noise>

        <vertical_position_noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.05</stddev>
        </vertical_position_noise>

        <horizontal_velocity_noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.05</stddev>
        </horizontal_velocity_noise>

        <vertical_velocity_noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.05</stddev>
        </vertical_velocity_noise>

      </sensor>
    </link>
    <joint name="fix_gps" type="fixed">
      <parent>sensors_frame_link</parent>
      <child>gps_link</child>
    </joint>

    <!-- ================= IMU ================= -->
    <link name="imu_link">
      <pose>0 -0.89 0.51 0 0 0</pose>
      <sensor name="imu" type="imu">
        <topic>interceptor/imu</topic>
        <gz_frame_id>imu_interceptor</gz_frame_id>
        <imu>
          <orientation_reference_frame>
            <localization>
              ENU
            </localization>
          </orientation_reference_frame>
          <linear_acceleration>
            <x>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>0.01</stddev>
              </noise>
            </x>
            <y>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>0.01</stddev>
              </noise>
            </y>
            <z>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>0.01</stddev>
              </noise>
            </z>
          </linear_acceleration>
          <angular_velocity>
            <x>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>0.01</stddev>
              </noise>
            </x>
            <y>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>0.01</stddev>
              </noise>
            </y>
            <z>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>0.01</stddev>
              </noise>
            </z>
          </angular_velocity>
        </imu>
        <always_on>1</always_on>
        <update_rate>25</update_rate>
        <visualize>true</visualize>
      </sensor>
    </link>
    <joint name="fix_imu" type="fixed">
      <parent>sensors_frame_link</parent>
      <child>imu_link</child>
    </joint>

    <!-- ================= RADAR ARS-408 ================= -->
    <link name="radar_link">
      <pose>0 -0.20728 0.36112 0 0 0</pose>
      <inertial>
        <mass>0.1</mass>
      </inertial>
      <visual name="radar_visual">
        <geometry>
          <mesh>
            <uri>models://radar_ARS-408/meshes/visual.dae</uri>
          </mesh>
        </geometry>
      </visual>
    </link>

    <joint name="fix_radar" type="fixed">
      <parent>base_link</parent>
      <child>radar_link</child>
    </joint>


    <!-- ================================================= -->
    <!-- ================= ENGINES ======================== -->
    <!-- ================================================= -->
    <!-- ================= ENGINE LEFT ================= -->
    <link name="engine_left_base_link">
      <pose>-0.176 -0.72691 -0.089506 0 0 0</pose>
      <inertial>
        <mass>0.001</mass>
        <inertia>
          <ixx>0.889245</ixx>
          <iyy>0.911125</iyy>
          <izz>0.078125</izz>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyz>0.0</iyz>
        </inertia>
      </inertial>
      <visual name="engine_left_visual">
        <geometry>
          <mesh>
            <uri>models://engine_1800/meshes/engine.dae</uri>
          </mesh>
        </geometry>
      </visual>
    </link>

    <joint name="fix_engine_left" type="fixed">
      <parent>base_link</parent>
      <child>engine_left_base_link</child>
    </joint>

    <link name="engine_left_propeller_link">
      <pose>-0.176 -0.72691 -0.089506 0 0 0</pose>
      <visual name="propeller_left_visual">
        <geometry>
          <mesh>
            <uri>models://engine_1800/meshes/propeller.dae</uri>
          </mesh>
        </geometry>
      </visual>
      <inertial>
        <mass>0.1</mass>
        <inertia>
          <ixx>0.008545</ixx>
          <iyy>0.008545</iyy>
          <izz>0.0144</izz>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyz>0.0</iyz>
        </inertia>
      </inertial>
    </link>

    <joint name="engine_left_propeller_joint" type="revolute">
      <parent>engine_left_base_link</parent>
      <child>engine_left_propeller_link</child>
      <axis>
        <xyz expressed_in="engine_left_propeller_link">0 1 0</xyz>
        <limit>
          <lower>-1.79769e+308</lower>
          <upper>1.79769e+308</upper>
        </limit>
      </axis>
    </joint>

    <plugin filename="gz-sim-thruster-system"
      name="gz::sim::systems::Thruster">
      <joint_name>engine_left_propeller_joint</joint_name>
      <thrust_coefficient>0.012</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.2</propeller_diameter>
      <p_gain>1</p_gain>
      <topic>engine_left/cmd_thrust</topic>
    </plugin>

    <!-- ================= ENGINE RIGHT ================= -->
    <link name="engine_right_base_link">
      <pose>0.176 -0.72691 -0.089506 0 0 0</pose>
      <inertial>
        <mass>0.001</mass>
        <inertia>
          <ixx>0.889245</ixx>
          <iyy>0.911125</iyy>
          <izz>0.078125</izz>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyz>0.0</iyz>
        </inertia>
      </inertial>
      <visual name="engine_right_visual">
        <geometry>
          <mesh>
            <uri>models://engine_1800/meshes/engine.dae</uri>
          </mesh>
        </geometry>
      </visual>
    </link>

    <joint name="fix_engine_right" type="fixed">
      <parent>base_link</parent>
      <child>engine_right_base_link</child>
    </joint>

    <link name="engine_right_propeller_link">
      <pose>0.176 -0.72691 -0.089506 0 0 0</pose>
      <visual name="propeller_right_visual">
        <geometry>
          <mesh>
            <uri>models://engine_1800/meshes/propeller.dae</uri>
          </mesh>
        </geometry>
      </visual>
      <inertial>
        <mass>0.1</mass>
        <inertia>
          <ixx>0.008545</ixx>
          <iyy>0.008545</iyy>
          <izz>0.0144</izz>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyz>0.0</iyz>
        </inertia>
      </inertial>
    </link>

    <joint name="engine_right_propeller_joint" type="revolute">
      <parent>engine_right_base_link</parent>
      <child>engine_right_propeller_link</child>
      <axis>
        <xyz expressed_in="engine_right_propeller_link">0 1 0</xyz>
        <limit>
          <lower>-1.79769e+308</lower>
          <upper>1.79769e+308</upper>
        </limit>
      </axis>
    </joint>

    <plugin filename="gz-sim-thruster-system"
      name="gz::sim::systems::Thruster">
      <joint_name>engine_right_propeller_joint</joint_name>
      <thrust_coefficient>0.012</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.2</propeller_diameter>
      <p_gain>1</p_gain>
      <topic>engine_right/cmd_thrust</topic>
    </plugin>


    <!-- ================================================= -->
    <!-- =============== HYDRODYNAMICS ==================== -->
    <!-- ================================================= -->
    <plugin filename="gz-waves1-hydrodynamics-system"
      name="gz::sim::systems::Hydrodynamics">
      <enable>interceptor::base_link</enable>
      <hydrodynamics>
        <damping_on>1</damping_on>
        <viscous_drag_on>1</viscous_drag_on>
        <pressure_drag_on>1</pressure_drag_on>
        <cDampL1>10.8</cDampL1>
        <cDampL2>10.0</cDampL2>
        <cDampR1>20.0</cDampR1>
        <cDampR2>12.5</cDampR2>
        <cPDrag1>72.4</cPDrag1>
        <fPDrag>1.0</fPDrag>
        <vRDrag>10.0</vRDrag>
      </hydrodynamics>
    </plugin>

    <!-- ================================================= -->
    <!-- ================= ARDUPILOT ====================== -->
    <!-- ================================================= -->
    <plugin name="ArduPilotPlugin" filename="ArduPilotPlugin">
      <fdm_addr>127.0.0.1</fdm_addr>
      <fdm_port_in>9002</fdm_port_in>
      <imuName>imu_sensor</imuName>

      <control channel="3">
        <jointName>engine_left_joint</jointName>
        <useForce>1</useForce>
        <multiplier>10</multiplier>
        <servo_min>1000</servo_min>
        <servo_max>2000</servo_max>
        <type>COMMAND</type>
        <cmd_topic>interceptor/engine_left/cmd_thrust</cmd_topic>
      </control>

      <control channel="4">
        <jointName>engine_right_joint</jointName>
        <useForce>1</useForce>
        <multiplier>10</multiplier>
        <servo_min>1000</servo_min>
        <servo_max>2000</servo_max>
        <type>COMMAND</type>
        <cmd_topic>interceptor/engine_right/cmd_thrust</cmd_topic>
      </control>
    </plugin>

    <plugin
      filename="gz-sim-odometry-publisher-system"
      name="gz::sim::systems::OdometryPublisher">
      <dimensions>3</dimensions>
      <odom_frame>map</odom_frame>
      <odom_publish_frequency>60</odom_publish_frequency>
    </plugin>


  </model>
</sdf>